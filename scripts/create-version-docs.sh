#!/bin/bash

# VoiceBox ç‰ˆæœ¬æ–‡æ¡£ç”Ÿæˆè„šæœ¬
# ç”¨æ³•: ./scripts/create-version-docs.sh <version> <feature-name>
# ç¤ºä¾‹: ./scripts/create-version-docs.sh v1.1 personality-analysis

set -e

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ£€æŸ¥å‚æ•°
if [ $# -lt 2 ]; then
    echo -e "${RED}é”™è¯¯: ç¼ºå°‘å‚æ•°${NC}"
    echo "ç”¨æ³•: $0 <version> <feature-name>"
    echo "ç¤ºä¾‹: $0 v1.1 personality-analysis"
    exit 1
fi

VERSION=$1
FEATURE_NAME=$2
DIR_NAME="${VERSION}-${FEATURE_NAME}"
BASE_DIR="docs/versions/${DIR_NAME}"

# æ£€æŸ¥ç›®å½•æ˜¯å¦å·²å­˜åœ¨
if [ -d "$BASE_DIR" ]; then
    echo -e "${RED}é”™è¯¯: ç›®å½• ${BASE_DIR} å·²å­˜åœ¨${NC}"
    exit 1
fi

# åˆ›å»ºç›®å½•
echo -e "${GREEN}åˆ›å»ºç‰ˆæœ¬ç›®å½•: ${BASE_DIR}${NC}"
mkdir -p "$BASE_DIR"

# è·å–å½“å‰æ—¥æœŸ
CURRENT_DATE=$(date +%Y-%m-%d)

# ç”Ÿæˆ requirements.md
echo -e "${YELLOW}ç”Ÿæˆ requirements.md...${NC}"
cat > "${BASE_DIR}/requirements.md" << EOF
# ${VERSION} ${FEATURE_NAME} - éœ€æ±‚æ–‡æ¡£

**ç‰ˆæœ¬**: ${VERSION}  
**åˆ›å»ºæ—¥æœŸ**: ${CURRENT_DATE}  
**çŠ¶æ€**: ğŸ“ è§„åˆ’ä¸­  
**ä¼˜å…ˆçº§**: P0 (æœ€é«˜)

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

[åœ¨æ­¤æè¿°åŠŸèƒ½çš„æ•´ä½“æ¦‚è¿°]

## ğŸ¯ ä¸šåŠ¡ç›®æ ‡

1. **ç›®æ ‡1**: [æè¿°ä¸šåŠ¡ç›®æ ‡]
2. **ç›®æ ‡2**: [æè¿°ä¸šåŠ¡ç›®æ ‡]
3. **ç›®æ ‡3**: [æè¿°ä¸šåŠ¡ç›®æ ‡]

## ğŸ‘¥ ç”¨æˆ·æ•…äº‹

### æ•…äº‹1: [æ•…äº‹æ ‡é¢˜]

**ä½œä¸º** [è§’è‰²]  
**æˆ‘å¸Œæœ›** [åŠŸèƒ½]  
**ä»¥ä¾¿** [ä»·å€¼]

**éªŒæ”¶æ ‡å‡†**:
- æ ‡å‡†1
- æ ‡å‡†2
- æ ‡å‡†3

### æ•…äº‹2: [æ•…äº‹æ ‡é¢˜]

**ä½œä¸º** [è§’è‰²]  
**æˆ‘å¸Œæœ›** [åŠŸèƒ½]  
**ä»¥ä¾¿** [ä»·å€¼]

**éªŒæ”¶æ ‡å‡†**:
- æ ‡å‡†1
- æ ‡å‡†2
- æ ‡å‡†3

## âœ… åŠŸèƒ½éœ€æ±‚

### FR1: [åŠŸèƒ½éœ€æ±‚1]

**ä¼˜å…ˆçº§**: P0

**æè¿°**: [è¯¦ç»†æè¿°]

**è¯¦ç»†éœ€æ±‚**:
1. éœ€æ±‚ç‚¹1
2. éœ€æ±‚ç‚¹2
3. éœ€æ±‚ç‚¹3

**éªŒæ”¶æ ‡å‡†**:
- æ ‡å‡†1
- æ ‡å‡†2
- æ ‡å‡†3

### FR2: [åŠŸèƒ½éœ€æ±‚2]

**ä¼˜å…ˆçº§**: P1

**æè¿°**: [è¯¦ç»†æè¿°]

**è¯¦ç»†éœ€æ±‚**:
1. éœ€æ±‚ç‚¹1
2. éœ€æ±‚ç‚¹2
3. éœ€æ±‚ç‚¹3

**éªŒæ”¶æ ‡å‡†**:
- æ ‡å‡†1
- æ ‡å‡†2
- æ ‡å‡†3

## ğŸ”’ éåŠŸèƒ½æ€§éœ€æ±‚

### NFR1: æ€§èƒ½è¦æ±‚

- å“åº”æ—¶é—´: <Xms
- å¹¶å‘ç”¨æˆ·æ•°: X+
- ååé‡: X QPS

### NFR2: å¯ç”¨æ€§è¦æ±‚

- ç³»ç»Ÿå¯ç”¨æ€§: 99.X%
- æ•°æ®æŒä¹…æ€§: 99.XX%

### NFR3: å®‰å…¨æ€§è¦æ±‚

- æ•°æ®åŠ å¯†
- è®¿é—®æ§åˆ¶
- å®¡è®¡æ—¥å¿—

### NFR4: å…¼å®¹æ€§è¦æ±‚

- æµè§ˆå™¨æ”¯æŒ
- ç§»åŠ¨ç«¯æ”¯æŒ
- ç¬¬ä¸‰æ–¹é›†æˆ

## ğŸš« çº¦æŸæ¡ä»¶

### æŠ€æœ¯çº¦æŸ

1. çº¦æŸ1
2. çº¦æŸ2

### ä¸šåŠ¡çº¦æŸ

1. çº¦æŸ1
2. çº¦æŸ2

### æ—¶é—´çº¦æŸ

1. å¼€å‘å‘¨æœŸ: Xå‘¨
2. æµ‹è¯•å‘¨æœŸ: Xå‘¨
3. ä¸Šçº¿æ—¶é—´: ç¬¬Xå‘¨

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### ä¸šåŠ¡æŒ‡æ ‡

- æŒ‡æ ‡1: >X%
- æŒ‡æ ‡2: >X%

### æŠ€æœ¯æŒ‡æ ‡

- æŒ‡æ ‡1: <Xms
- æŒ‡æ ‡2: >XX%

## ğŸ”„ æœªæ¥æ‰©å±•

### v${VERSION}.1 è®¡åˆ’

- æ‰©å±•åŠŸèƒ½1
- æ‰©å±•åŠŸèƒ½2

---

**æ–‡æ¡£ç»´æŠ¤è€…**: VoiceBoxå¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: ${CURRENT_DATE}  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
EOF

# ç”Ÿæˆ design.md
echo -e "${YELLOW}ç”Ÿæˆ design.md...${NC}"
cat > "${BASE_DIR}/design.md" << EOF
# ${VERSION} ${FEATURE_NAME} - è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: ${VERSION}  
**åˆ›å»ºæ—¥æœŸ**: ${CURRENT_DATE}  
**çŠ¶æ€**: ğŸ“ è§„åˆ’ä¸­  
**è®¾è®¡è´Ÿè´£äºº**: VoiceBoxæ¶æ„å›¢é˜Ÿ

---

## ğŸ“ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

\`\`\`
[åœ¨æ­¤ç»˜åˆ¶ç³»ç»Ÿæ¶æ„å›¾]
\`\`\`

### æŠ€æœ¯æ ˆé€‰å‹

**åç«¯**:
- æ¡†æ¶: Spring Boot 2.7+
- æ•°æ®åº“: MySQL 8.0+
- ç¼“å­˜: Redis 6.0+

**å‰ç«¯**:
- æ¡†æ¶: Vue 3 + Vite
- çŠ¶æ€ç®¡ç†: Pinia
- HTTPå®¢æˆ·ç«¯: Axios

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹è®¾è®¡

### è¡¨1: [è¡¨å]

\`\`\`sql
CREATE TABLE table_name (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    -- å­—æ®µå®šä¹‰
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¡¨è¯´æ˜';
\`\`\`

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. ç»„ä»¶1

**èŒè´£**: [æè¿°ç»„ä»¶èŒè´£]

**æ ¸å¿ƒæ–¹æ³•**:

\`\`\`java
@Service
public class ComponentService {
    // å®ç°ä»£ç 
}
\`\`\`

### 2. ç»„ä»¶2

**èŒè´£**: [æè¿°ç»„ä»¶èŒè´£]

**æ ¸å¿ƒæ–¹æ³•**:

\`\`\`java
@Service
public class ComponentService {
    // å®ç°ä»£ç 
}
\`\`\`

## ğŸ” å®‰å…¨è®¾è®¡

### æ•°æ®åŠ å¯†

- æ•æ„Ÿæ•°æ®åŠ å¯†æ–¹æ¡ˆ
- ä¼ è¾“åŠ å¯†æ–¹æ¡ˆ

### è®¿é—®æ§åˆ¶

- èº«ä»½éªŒè¯æœºåˆ¶
- æƒé™æ§åˆ¶æœºåˆ¶

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

- ç¼“å­˜å±‚çº§
- ç¼“å­˜æ›´æ–°ç­–ç•¥
- ç¼“å­˜å¤±æ•ˆç­–ç•¥

### æ•°æ®åº“ä¼˜åŒ–

- ç´¢å¼•è®¾è®¡
- æŸ¥è¯¢ä¼˜åŒ–
- åˆ†åº“åˆ†è¡¨

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### ç›‘æ§æŒ‡æ ‡

- ä¸šåŠ¡æŒ‡æ ‡
- æŠ€æœ¯æŒ‡æ ‡
- å‘Šè­¦è§„åˆ™

### æ—¥å¿—è®¾è®¡

- æ—¥å¿—çº§åˆ«
- æ—¥å¿—æ ¼å¼
- æ—¥å¿—å­˜å‚¨

---

**æ–‡æ¡£ç»´æŠ¤è€…**: VoiceBoxæ¶æ„å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: ${CURRENT_DATE}  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
EOF

# ç”Ÿæˆ implementation-plan.md
echo -e "${YELLOW}ç”Ÿæˆ implementation-plan.md...${NC}"
cat > "${BASE_DIR}/implementation-plan.md" << EOF
# ${VERSION} ${FEATURE_NAME} - å®æ–½è®¡åˆ’

**ç‰ˆæœ¬**: ${VERSION}  
**åˆ›å»ºæ—¥æœŸ**: ${CURRENT_DATE}  
**è®¡åˆ’å¼€å§‹**: [å¼€å§‹æ—¥æœŸ]  
**è®¡åˆ’å®Œæˆ**: [å®Œæˆæ—¥æœŸ]  
**æ€»å·¥æœŸ**: Xå‘¨

---

## ğŸ“… å¼€å‘è®¡åˆ’

### ç¬¬1å‘¨: [é˜¶æ®µåç§°]

#### ä»»åŠ¡1.1: [ä»»åŠ¡åç§°] (Xå¤©)
- **è´Ÿè´£äºº**: [è´Ÿè´£äºº]
- **å·¥ä½œå†…å®¹**:
  - å·¥ä½œé¡¹1
  - å·¥ä½œé¡¹2
  - å·¥ä½œé¡¹3
- **äº¤ä»˜ç‰©**: [äº¤ä»˜ç‰©åˆ—è¡¨]
- **éªŒæ”¶æ ‡å‡†**: [éªŒæ”¶æ ‡å‡†]

#### ä»»åŠ¡1.2: [ä»»åŠ¡åç§°] (Xå¤©)
- **è´Ÿè´£äºº**: [è´Ÿè´£äºº]
- **å·¥ä½œå†…å®¹**:
  - å·¥ä½œé¡¹1
  - å·¥ä½œé¡¹2
- **äº¤ä»˜ç‰©**: [äº¤ä»˜ç‰©åˆ—è¡¨]
- **éªŒæ”¶æ ‡å‡†**: [éªŒæ”¶æ ‡å‡†]

### ç¬¬2å‘¨: [é˜¶æ®µåç§°]

#### ä»»åŠ¡2.1: [ä»»åŠ¡åç§°] (Xå¤©)
- **è´Ÿè´£äºº**: [è´Ÿè´£äºº]
- **å·¥ä½œå†…å®¹**:
  - å·¥ä½œé¡¹1
  - å·¥ä½œé¡¹2
- **äº¤ä»˜ç‰©**: [äº¤ä»˜ç‰©åˆ—è¡¨]
- **éªŒæ”¶æ ‡å‡†**: [éªŒæ”¶æ ‡å‡†]

## ğŸ“Š èµ„æºåˆ†é…

| è§’è‰² | äººå‘˜ | å·¥ä½œé‡ |
|------|------|--------|
| åç«¯å¼€å‘ | 2äºº | Xäººå¤© |
| å‰ç«¯å¼€å‘ | 1äºº | Xäººå¤© |
| æµ‹è¯•å·¥ç¨‹å¸ˆ | 1äºº | Xäººå¤© |

## ğŸ¯ é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | æ—¥æœŸ | äº¤ä»˜ç‰© |
|--------|------|--------|
| éœ€æ±‚è¯„å®¡å®Œæˆ | [æ—¥æœŸ] | éœ€æ±‚æ–‡æ¡£ |
| è®¾è®¡è¯„å®¡å®Œæˆ | [æ—¥æœŸ] | è®¾è®¡æ–‡æ¡£ |
| å¼€å‘å®Œæˆ | [æ—¥æœŸ] | åŠŸèƒ½ä»£ç  |
| æµ‹è¯•å®Œæˆ | [æ—¥æœŸ] | æµ‹è¯•æŠ¥å‘Š |
| ä¸Šçº¿å‘å¸ƒ | [æ—¥æœŸ] | ç”Ÿäº§ç¯å¢ƒ |

## âš ï¸ é£é™©è¯„ä¼°

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| é£é™©1 | é«˜ | ä¸­ | åº”å¯¹æªæ–½ |
| é£é™©2 | ä¸­ | ä½ | åº”å¯¹æªæ–½ |

## âœ… æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡: >80%
- æµ‹è¯•æ¡†æ¶: JUnit 5

### é›†æˆæµ‹è¯•
- æµ‹è¯•åœºæ™¯: [åœºæ™¯åˆ—è¡¨]
- æµ‹è¯•å·¥å…·: [å·¥å…·åˆ—è¡¨]

### æ€§èƒ½æµ‹è¯•
- å¹¶å‘ç”¨æˆ·æ•°: X
- å“åº”æ—¶é—´è¦æ±‚: <Xms
- æµ‹è¯•å·¥å…·: JMeter

---

**æ–‡æ¡£ç»´æŠ¤è€…**: VoiceBoxé¡¹ç›®ç®¡ç†å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: ${CURRENT_DATE}  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
EOF

# ç”Ÿæˆ api-spec.md
echo -e "${YELLOW}ç”Ÿæˆ api-spec.md...${NC}"
cat > "${BASE_DIR}/api-spec.md" << EOF
# ${VERSION} ${FEATURE_NAME} - APIè§„æ ¼è¯´æ˜

**ç‰ˆæœ¬**: ${VERSION}  
**åˆ›å»ºæ—¥æœŸ**: ${CURRENT_DATE}  
**Base URL**: \`https://api.voicebox.com/v1\`

---

## ğŸ“¡ APIåˆ—è¡¨

### 1. [APIåç§°]

**ç«¯ç‚¹**: \`POST /endpoint\`

**æè¿°**: [APIåŠŸèƒ½æè¿°]

**è¯·æ±‚å¤´**:
\`\`\`
Content-Type: application/json
Authorization: Bearer {token}
\`\`\`

**è¯·æ±‚ä½“**:
\`\`\`json
{
  "field1": "value1",
  "field2": "value2"
}
\`\`\`

**å“åº”**:
\`\`\`json
{
  "code": 200,
  "message": "success",
  "data": {
    "field1": "value1",
    "field2": "value2"
  }
}
\`\`\`

**é”™è¯¯ç **:
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

### 2. [APIåç§°]

**ç«¯ç‚¹**: \`GET /endpoint/{id}\`

**æè¿°**: [APIåŠŸèƒ½æè¿°]

**è·¯å¾„å‚æ•°**:
- \`id\`: [å‚æ•°è¯´æ˜]

**æŸ¥è¯¢å‚æ•°**:
- \`param1\`: [å‚æ•°è¯´æ˜]
- \`param2\`: [å‚æ•°è¯´æ˜]

**å“åº”**:
\`\`\`json
{
  "code": 200,
  "message": "success",
  "data": {
    "field1": "value1",
    "field2": "value2"
  }
}
\`\`\`

## ğŸ“ æ•°æ®æ¨¡å‹

### Model1

\`\`\`json
{
  "field1": "string",
  "field2": "number",
  "field3": "boolean"
}
\`\`\`

**å­—æ®µè¯´æ˜**:
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| field1 | string | æ˜¯ | å­—æ®µè¯´æ˜ |
| field2 | number | å¦ | å­—æ®µè¯´æ˜ |
| field3 | boolean | å¦ | å­—æ®µè¯´æ˜ |

---

**æ–‡æ¡£ç»´æŠ¤è€…**: VoiceBox APIå›¢é˜Ÿ  
**æœ€åæ›´æ–°**: ${CURRENT_DATE}
EOF

# æ›´æ–°ç‰ˆæœ¬åˆ—è¡¨
echo -e "${YELLOW}æ›´æ–°ç‰ˆæœ¬åˆ—è¡¨...${NC}"
# è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªåŠ¨æ›´æ–° docs/versions/README.md çš„é€»è¾‘

echo -e "${GREEN}âœ… ç‰ˆæœ¬æ–‡æ¡£åˆ›å»ºå®Œæˆï¼${NC}"
echo -e "${GREEN}ç›®å½•ä½ç½®: ${BASE_DIR}${NC}"
echo ""
echo -e "${YELLOW}ä¸‹ä¸€æ­¥:${NC}"
echo "1. ç¼–è¾‘ ${BASE_DIR}/requirements.md å¡«å†™éœ€æ±‚è¯¦æƒ…"
echo "2. ç¼–è¾‘ ${BASE_DIR}/design.md å¡«å†™è®¾è®¡è¯¦æƒ…"
echo "3. ç¼–è¾‘ ${BASE_DIR}/implementation-plan.md å¡«å†™å®æ–½è®¡åˆ’"
echo "4. ç¼–è¾‘ ${BASE_DIR}/api-spec.md å¡«å†™APIè§„æ ¼"
echo ""
echo -e "${GREEN}ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€${NC}"
EOF

chmod +x scripts/create-version-docs.sh

echo "âœ… è„šæœ¬åˆ›å»ºå®Œæˆï¼"
