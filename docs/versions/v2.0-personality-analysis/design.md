# v2.0 ç”¨æˆ·ä¸ªæ€§åˆ†æç³»ç»Ÿ - è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v2.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-01-15  
**çŠ¶æ€**: ğŸ“ è§„åˆ’ä¸­  
**è®¾è®¡è´Ÿè´£äºº**: VoiceBoxæ¶æ„å›¢é˜Ÿ

---

## ğŸ“ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å‰ç«¯å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç”¨æˆ·ç”»åƒå±•ç¤º        â”‚    ä¸ªæ€§åŒ–è®¾ç½®                              â”‚
â”‚   - æ€§æ ¼é›·è¾¾å›¾        â”‚    - åå¥½é…ç½®                              â”‚
â”‚   - å…´è¶£äº‘å›¾          â”‚    - éšç§æ§åˆ¶                              â”‚
â”‚   - æ´»è·ƒåº¦æ›²çº¿        â”‚    - æ•°æ®å¯¼å‡º                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APIç½‘å…³å±‚                                  â”‚
â”‚  - è¯·æ±‚è·¯ç”±  - èº«ä»½éªŒè¯  - é™æµæ§åˆ¶  - æ—¥å¿—è®°å½•                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨æœåŠ¡å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸ªæ€§åˆ†ææœåŠ¡         â”‚   æ ‡ç­¾ç®¡ç†æœåŠ¡                            â”‚
â”‚  - ç‰¹å¾æå–          â”‚   - æ ‡ç­¾ç”Ÿæˆ                              â”‚
â”‚  - ç”»åƒæ„å»º          â”‚   - æ ‡ç­¾æ›´æ–°                              â”‚
â”‚  - ç­–ç•¥è®¡ç®—          â”‚   - æ ‡ç­¾æ¸…ç†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­¦ä¹ é€‚åº”æœåŠ¡         â”‚   ä¸Šä¸‹æ–‡è®°å¿†æœåŠ¡                          â”‚
â”‚  - åé¦ˆæ”¶é›†          â”‚   - çŸ­æœŸè®°å¿†                              â”‚
â”‚  - æ¨¡å‹æ›´æ–°          â”‚   - é•¿æœŸè®°å¿†                              â”‚
â”‚  - æ•ˆæœè¯„ä¼°          â”‚   - è®°å¿†æ£€ç´¢                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å±‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   MySQLæ•°æ®åº“         â”‚    Redisç¼“å­˜                              â”‚
â”‚  - ç”¨æˆ·ç”»åƒ          â”‚   - çƒ­ç‚¹æ•°æ®                              â”‚
â”‚  - æ ‡ç­¾æ•°æ®          â”‚   - ä¼šè¯ç¼“å­˜                              â”‚
â”‚  - å¯¹è¯å†å²          â”‚   - è®¡ç®—ç»“æœ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Elasticsearch       â”‚    æ¶ˆæ¯é˜Ÿåˆ—                               â”‚
â”‚  - å…¨æ–‡æ£€ç´¢          â”‚   - å¼‚æ­¥ä»»åŠ¡                              â”‚
â”‚  - æ—¥å¿—åˆ†æ          â”‚   - äº‹ä»¶é€šçŸ¥                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

**åç«¯**:
- æ¡†æ¶: Spring Boot 2.3.x (å…¼å®¹JDK 1.8)
- æ•°æ®åº“: MySQL 5.7
- ç¼“å­˜: Redis 5.0+ (æ¨è6.0+)
- æœç´¢: Elasticsearch 6.x (å¯é€‰)
- æ¶ˆæ¯é˜Ÿåˆ—: RabbitMQ 3.x (å¯é€‰)
- NLP: HanLP portable-1.8.4

**å‰ç«¯**:
- æ¡†æ¶: Vue 3 + Vite
- å›¾è¡¨: ECharts 5.x
- çŠ¶æ€ç®¡ç†: Pinia
- HTTPå®¢æˆ·ç«¯: Axios

**æœºå™¨å­¦ä¹ ** (å¯é€‰):
- Python 3.7+
- scikit-learn
- è½»é‡çº§æ¨¡å‹


## ğŸ—„ï¸ æ•°æ®æ¨¡å‹è®¾è®¡

### ç”¨æˆ·ç”»åƒè¡¨ (user_profiles)

```sql
CREATE TABLE user_profiles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL UNIQUE COMMENT 'ç”¨æˆ·ID',
    
    -- æ€§æ ¼ç»´åº¦ (å¤§äº”äººæ ¼æ¨¡å‹)
    openness DECIMAL(4,3) DEFAULT 0.500 COMMENT 'å¼€æ”¾æ€§ 0-1',
    conscientiousness DECIMAL(4,3) DEFAULT 0.500 COMMENT 'å°½è´£æ€§ 0-1',
    extraversion DECIMAL(4,3) DEFAULT 0.500 COMMENT 'å¤–å‘æ€§ 0-1',
    agreeableness DECIMAL(4,3) DEFAULT 0.500 COMMENT 'å®œäººæ€§ 0-1',
    neuroticism DECIMAL(4,3) DEFAULT 0.500 COMMENT 'ç¥ç»è´¨ 0-1',
    
    -- åå¥½ç»´åº¦
    response_length_preference VARCHAR(20) DEFAULT 'balanced' COMMENT 'concise/balanced/detailed',
    language_style_preference VARCHAR(20) DEFAULT 'balanced' COMMENT 'formal/balanced/casual',
    content_format_preference JSON COMMENT 'å†…å®¹æ ¼å¼åå¥½ ["lists", "code", "tables"]',
    interaction_style VARCHAR(20) DEFAULT 'balanced' COMMENT 'active/balanced/passive',
    
    -- ç»Ÿè®¡ä¿¡æ¯
    total_messages INT DEFAULT 0 COMMENT 'æ€»æ¶ˆæ¯æ•°',
    total_sessions INT DEFAULT 0 COMMENT 'æ€»ä¼šè¯æ•°',
    avg_session_duration DECIMAL(10,2) COMMENT 'å¹³å‡ä¼šè¯æ—¶é•¿(åˆ†é’Ÿ)',
    confidence_score DECIMAL(4,3) DEFAULT 0.000 COMMENT 'ç”»åƒç½®ä¿¡åº¦ 0-1',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_analyzed_at TIMESTAMP COMMENT 'æœ€ååˆ†ææ—¶é—´',
    
    INDEX idx_user_id (user_id),
    INDEX idx_confidence (confidence_score),
    INDEX idx_updated_at (updated_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ç”»åƒè¡¨';
```

### ç”¨æˆ·æ ‡ç­¾è¡¨ (user_tags) - å·²å­˜åœ¨ï¼Œéœ€ä¼˜åŒ–

```sql
ALTER TABLE user_tags ADD COLUMN weight DECIMAL(4,3) DEFAULT 1.000 COMMENT 'æ ‡ç­¾æƒé‡';
ALTER TABLE user_tags ADD COLUMN expires_at TIMESTAMP NULL COMMENT 'è¿‡æœŸæ—¶é—´';
ALTER TABLE user_tags ADD COLUMN metadata JSON COMMENT 'æ ‡ç­¾å…ƒæ•°æ®';
ALTER TABLE user_tags ADD INDEX idx_confidence (confidence);
ALTER TABLE user_tags ADD INDEX idx_expires_at (expires_at);
```

### å¯¹è¯ç‰¹å¾è¡¨ (conversation_features)

```sql
CREATE TABLE conversation_features (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    session_id BIGINT NOT NULL,
    message_id BIGINT NOT NULL,
    
    -- è¯­è¨€å­¦ç‰¹å¾
    message_length INT COMMENT 'æ¶ˆæ¯é•¿åº¦',
    word_count INT COMMENT 'è¯æ•°',
    sentence_count INT COMMENT 'å¥å­æ•°',
    avg_word_length DECIMAL(5,2) COMMENT 'å¹³å‡è¯é•¿',
    vocabulary_richness DECIMAL(4,3) COMMENT 'è¯æ±‡ä¸°å¯Œåº¦',
    
    -- è¯­ä¹‰ç‰¹å¾
    topics JSON COMMENT 'ä¸»é¢˜æ ‡ç­¾ ["tech", "life"]',
    sentiment_score DECIMAL(4,3) COMMENT 'æƒ…æ„Ÿåˆ†æ•° -1åˆ°1',
    intent VARCHAR(50) COMMENT 'æ„å›¾ç±»å‹',
    keywords JSON COMMENT 'å…³é”®è¯åˆ—è¡¨',
    
    -- å¯¹è¯æ¨¡å¼
    question_count INT DEFAULT 0 COMMENT 'é—®é¢˜æ•°é‡',
    exclamation_count INT DEFAULT 0 COMMENT 'æ„Ÿå¹å·æ•°é‡',
    emoji_count INT DEFAULT 0 COMMENT 'è¡¨æƒ…ç¬¦å·æ•°é‡',
    code_block_count INT DEFAULT 0 COMMENT 'ä»£ç å—æ•°é‡',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_session_id (session_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å¯¹è¯ç‰¹å¾è¡¨';
```

### ç”¨æˆ·åé¦ˆè¡¨ (user_feedback)

```sql
CREATE TABLE user_feedback (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    session_id BIGINT NOT NULL,
    message_id BIGINT NOT NULL,
    
    -- åé¦ˆç±»å‹
    feedback_type VARCHAR(20) NOT NULL COMMENT 'like/dislike/regenerate/edit/copy',
    feedback_value INT COMMENT 'åé¦ˆå€¼ 1=æ­£é¢ -1=è´Ÿé¢',
    
    -- åé¦ˆå†…å®¹
    feedback_text TEXT COMMENT 'æ–‡å­—åé¦ˆ',
    feedback_tags JSON COMMENT 'åé¦ˆæ ‡ç­¾',
    
    -- ä¸Šä¸‹æ–‡
    ai_response_id BIGINT COMMENT 'AIå›å¤ID',
    response_strategy JSON COMMENT 'ä½¿ç”¨çš„å“åº”ç­–ç•¥',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_feedback_type (feedback_type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·åé¦ˆè¡¨';
```

### å­¦ä¹ è®°å½•è¡¨ (learning_records)

```sql
CREATE TABLE learning_records (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    
    -- å­¦ä¹ ç±»å‹
    learning_type VARCHAR(50) NOT NULL COMMENT 'profile_update/tag_adjustment/strategy_optimization',
    
    -- å­¦ä¹ å‰åå¯¹æ¯”
    before_state JSON COMMENT 'å­¦ä¹ å‰çŠ¶æ€',
    after_state JSON COMMENT 'å­¦ä¹ åçŠ¶æ€',
    
    -- å­¦ä¹ æ•ˆæœ
    improvement_score DECIMAL(4,3) COMMENT 'æ”¹è¿›åˆ†æ•°',
    confidence_change DECIMAL(4,3) COMMENT 'ç½®ä¿¡åº¦å˜åŒ–',
    
    -- è§¦å‘åŸå› 
    trigger_event VARCHAR(100) COMMENT 'è§¦å‘äº‹ä»¶',
    trigger_data JSON COMMENT 'è§¦å‘æ•°æ®',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_learning_type (learning_type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å­¦ä¹ è®°å½•è¡¨';
```


## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. ä¸ªæ€§åˆ†æå¼•æ“ (PersonalityAnalysisEngine)

**èŒè´£**: åˆ†æç”¨æˆ·å¯¹è¯å’Œè¡Œä¸ºï¼Œæ„å»ºç”¨æˆ·ç”»åƒ

**æ ¸å¿ƒç®—æ³•**:

```java
@Service
public class PersonalityAnalysisEngine {
    
    /**
     * åˆ†æç”¨æˆ·æ€§æ ¼ç»´åº¦
     * åŸºäºå¤§äº”äººæ ¼æ¨¡å‹ + å¯¹è¯ç‰¹å¾
     */
    public PersonalityScores analyzePersonality(Long userId) {
        // 1. è·å–ç”¨æˆ·æœ€è¿‘100æ¡å¯¹è¯
        List<ConversationFeature> features = getRecentFeatures(userId, 100);
        
        if (features.size() < 10) {
            return getDefaultScores(); // æ•°æ®ä¸è¶³ï¼Œè¿”å›é»˜è®¤å€¼
        }
        
        PersonalityScores scores = new PersonalityScores();
        
        // 2. è®¡ç®—å¼€æ”¾æ€§ (Openness)
        scores.setOpenness(calculateOpenness(features));
        
        // 3. è®¡ç®—å°½è´£æ€§ (Conscientiousness)
        scores.setConscientiousness(calculateConscientiousness(features));
        
        // 4. è®¡ç®—å¤–å‘æ€§ (Extraversion)
        scores.setExtraversion(calculateExtraversion(features));
        
        // 5. è®¡ç®—å®œäººæ€§ (Agreeableness)
        scores.setAgreeableness(calculateAgreeableness(features));
        
        // 6. è®¡ç®—ç¥ç»è´¨ (Neuroticism)
        scores.setNeuroticism(calculateNeuroticism(features));
        
        // 7. è®¡ç®—ç½®ä¿¡åº¦
        scores.setConfidence(calculateConfidence(features.size()));
        
        return scores;
    }
    
    /**
     * è®¡ç®—å¼€æ”¾æ€§
     * æŒ‡æ ‡: è¯é¢˜å¤šæ ·æ€§ã€è¯æ±‡ä¸°å¯Œåº¦ã€é—®é¢˜æ•°é‡
     */
    private double calculateOpenness(List<ConversationFeature> features) {
        double score = 0.5; // åŸºå‡†åˆ†
        
        // è¯é¢˜å¤šæ ·æ€§ (0-0.3åˆ†)
        Set<String> uniqueTopics = extractUniqueTopics(features);
        score += Math.min(0.3, uniqueTopics.size() * 0.03);
        
        // è¯æ±‡ä¸°å¯Œåº¦ (0-0.3åˆ†)
        double avgVocabularyRichness = features.stream()
            .mapToDouble(ConversationFeature::getVocabularyRichness)
            .average().orElse(0.5);
        score += (avgVocabularyRichness - 0.5) * 0.6;
        
        // é—®é¢˜æ•°é‡ (0-0.2åˆ†)
        double avgQuestions = features.stream()
            .mapToDouble(ConversationFeature::getQuestionCount)
            .average().orElse(0);
        score += Math.min(0.2, avgQuestions * 0.05);
        
        return clamp(score, 0, 1);
    }
    
    /**
     * è®¡ç®—å¤–å‘æ€§
     * æŒ‡æ ‡: æ¶ˆæ¯é•¿åº¦ã€æ„Ÿå¹å·ä½¿ç”¨ã€è¡¨æƒ…ç¬¦å·ã€ç§¯ææƒ…æ„Ÿ
     */
    private double calculateExtraversion(List<ConversationFeature> features) {
        double score = 0.5;
        
        // æ¶ˆæ¯é•¿åº¦ (0-0.25åˆ†)
        double avgLength = features.stream()
            .mapToDouble(ConversationFeature::getMessageLength)
            .average().orElse(50);
        score += Math.min(0.25, (avgLength - 50) / 400);
        
        // æ„Ÿå¹å·ä½¿ç”¨ (0-0.25åˆ†)
        double avgExclamations = features.stream()
            .mapToDouble(ConversationFeature::getExclamationCount)
            .average().orElse(0);
        score += Math.min(0.25, avgExclamations * 0.1);
        
        // è¡¨æƒ…ç¬¦å· (0-0.25åˆ†)
        double avgEmojis = features.stream()
            .mapToDouble(ConversationFeature::getEmojiCount)
            .average().orElse(0);
        score += Math.min(0.25, avgEmojis * 0.08);
        
        // ç§¯ææƒ…æ„Ÿ (0-0.25åˆ†)
        double avgSentiment = features.stream()
            .mapToDouble(f -> Math.max(0, f.getSentimentScore()))
            .average().orElse(0);
        score += avgSentiment * 0.25;
        
        return clamp(score, 0, 1);
    }
    
    /**
     * è®¡ç®—ç¥ç»è´¨ (æƒ…ç»ªç¨³å®šæ€§)
     * æŒ‡æ ‡: æƒ…ç»ªæ³¢åŠ¨ã€è´Ÿé¢æƒ…æ„Ÿã€ç„¦è™‘è¯æ±‡
     */
    private double calculateNeuroticism(List<ConversationFeature> features) {
        double score = 0.5;
        
        // æƒ…ç»ªæ³¢åŠ¨ (0-0.4åˆ†)
        double sentimentVariance = calculateSentimentVariance(features);
        score += sentimentVariance * 0.4;
        
        // è´Ÿé¢æƒ…æ„Ÿé¢‘ç‡ (0-0.3åˆ†)
        long negativeCount = features.stream()
            .filter(f -> f.getSentimentScore() < -0.2)
            .count();
        score += (double) negativeCount / features.size() * 0.3;
        
        // ç„¦è™‘è¯æ±‡ (0-0.3åˆ†)
        double anxietyScore = calculateAnxietyScore(features);
        score += anxietyScore * 0.3;
        
        return clamp(score, 0, 1);
    }
    
    /**
     * è®¡ç®—ç½®ä¿¡åº¦
     * åŸºäºæ ·æœ¬æ•°é‡å’Œæ•°æ®è´¨é‡
     */
    private double calculateConfidence(int sampleSize) {
        if (sampleSize < 10) return 0.0;
        if (sampleSize < 30) return 0.3;
        if (sampleSize < 50) return 0.5;
        if (sampleSize < 100) return 0.7;
        if (sampleSize < 200) return 0.85;
        return 0.95;
    }
    
    private double clamp(double value, double min, double max) {
        return Math.max(min, Math.min(max, value));
    }
}
```

### 2. æ™ºèƒ½æ ‡ç­¾ç”Ÿæˆå™¨ (SmartTagGenerator)

**èŒè´£**: è‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç†ç”¨æˆ·æ ‡ç­¾

**å®ç°æ–¹æ¡ˆ**:

```java
@Service
public class SmartTagGenerator {
    
    @Autowired
    private NLPService nlpService;
    
    @Autowired
    private UserTagRepository tagRepository;
    
    /**
     * ä»å¯¹è¯ä¸­ç”Ÿæˆæ ‡ç­¾
     * ä½¿ç”¨NLPæŠ€æœ¯æå–å…³é”®ä¿¡æ¯
     */
    public List<UserTag> generateTagsFromConversation(
        Long userId, 
        String conversationText
    ) {
        List<UserTag> tags = new ArrayList<>();
        
        // 1. ä¸»é¢˜æå–
        List<String> topics = nlpService.extractTopics(conversationText);
        for (String topic : topics) {
            tags.add(createTag(userId, "semantic", "topic_" + topic, 0.7));
        }
        
        // 2. å…³é”®è¯æå–
        List<String> keywords = nlpService.extractKeywords(conversationText, 10);
        for (String keyword : keywords) {
            tags.add(createTag(userId, "semantic", "keyword_" + keyword, 0.6));
        }
        
        // 3. å®ä½“è¯†åˆ«
        Map<String, List<String>> entities = nlpService.extractEntities(conversationText);
        for (Map.Entry<String, List<String>> entry : entities.entrySet()) {
            String entityType = entry.getKey();
            for (String entity : entry.getValue()) {
                tags.add(createTag(userId, "semantic", entityType + "_" + entity, 0.8));
            }
        }
        
        // 4. æƒ…æ„Ÿåˆ†æ
        double sentiment = nlpService.analyzeSentiment(conversationText);
        if (sentiment > 0.3) {
            tags.add(createTag(userId, "emotional", "positive_mood", 0.7));
        } else if (sentiment < -0.3) {
            tags.add(createTag(userId, "emotional", "negative_mood", 0.7));
        }
        
        return tags;
    }
    
    /**
     * åŸºäºè¡Œä¸ºæ¨¡å¼ç”Ÿæˆæ ‡ç­¾
     */
    public List<UserTag> generateBehavioralTags(
        Long userId,
        BehaviorMetrics metrics
    ) {
        List<UserTag> tags = new ArrayList<>();
        
        // æ´»è·ƒåº¦æ ‡ç­¾
        if (metrics.getMessageCount() > 100) {
            tags.add(createTag(userId, "behavioral", "frequent_user", 0.9));
        }
        
        // æ—¶é—´åå¥½æ ‡ç­¾
        Map<String, Integer> timeDistribution = metrics.getTimeDistribution();
        String peakTime = findPeakTime(timeDistribution);
        tags.add(createTag(userId, "behavioral", "peak_time_" + peakTime, 0.8));
        
        // å¯¹è¯æ·±åº¦æ ‡ç­¾
        if (metrics.getAvgSessionDuration() > 30) {
            tags.add(createTag(userId, "behavioral", "deep_thinker", 0.7));
        }
        
        // å“åº”é€Ÿåº¦æ ‡ç­¾
        if (metrics.getAvgResponseTime() < 5) {
            tags.add(createTag(userId, "behavioral", "quick_responder", 0.6));
        }
        
        return tags;
    }
    
    /**
     * æ™ºèƒ½æ ‡ç­¾åˆå¹¶
     * åˆå¹¶ç›¸ä¼¼æ ‡ç­¾ï¼Œæé«˜ç½®ä¿¡åº¦
     */
    public void mergeSimil arTags(Long userId) {
        List<UserTag> tags = tagRepository.findByUserId(userId);
        
        // æŒ‰ç±»åˆ«åˆ†ç»„
        Map<String, List<UserTag>> tagsByCategory = tags.stream()
            .collect(Collectors.groupingBy(UserTag::getCategory));
        
        for (List<UserTag> categoryTags : tagsByCategory.values()) {
            // æŸ¥æ‰¾ç›¸ä¼¼æ ‡ç­¾
            for (int i = 0; i < categoryTags.size(); i++) {
                for (int j = i + 1; j < categoryTags.size(); j++) {
                    UserTag tag1 = categoryTags.get(i);
                    UserTag tag2 = categoryTags.get(j);
                    
                    if (isSimilar(tag1.getTagName(), tag2.getTagName())) {
                        // åˆå¹¶æ ‡ç­¾
                        double newConfidence = Math.max(
                            tag1.getConfidence().doubleValue(),
                            tag2.getConfidence().doubleValue()
                        ) + 0.1;
                        tag1.setConfidence(BigDecimal.valueOf(Math.min(1.0, newConfidence)));
                        tagRepository.update(tag1);
                        tagRepository.delete(tag2.getId());
                    }
                }
            }
        }
    }
    
    /**
     * æ ‡ç­¾è¡°å‡
     * é™ä½é•¿æ—¶é—´æœªæ›´æ–°æ ‡ç­¾çš„ç½®ä¿¡åº¦
     */
    public void decayOldTags(Long userId, int daysThreshold) {
        List<UserTag> tags = tagRepository.findByUserId(userId);
        LocalDateTime cutoff = LocalDateTime.now().minusDays(daysThreshold);
        
        for (UserTag tag : tags) {
            if (tag.getUpdatedAt().isBefore(cutoff)) {
                double decay = 0.05 * ((daysThreshold - 
                    ChronoUnit.DAYS.between(tag.getUpdatedAt(), LocalDateTime.now())) / daysThreshold);
                double newConfidence = Math.max(0, tag.getConfidence().doubleValue() - decay);
                
                if (newConfidence < 0.3) {
                    tagRepository.delete(tag.getId());
                } else {
                    tag.setConfidence(BigDecimal.valueOf(newConfidence));
                    tagRepository.update(tag);
                }
            }
        }
    }
}
```

